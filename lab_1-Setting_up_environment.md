# Lab 1: Setting up your environment

Now that you have a local version of this repository saved on your device after completing the [Getting Started](https://github.com/Bijesse/otel-workshop) requirements, it is time to set up your environment to run this application.

## Configure Minikube
Run the following terminal command to spin up your local environment 

```bash
minikube start --memory 8192 --cpus 6
```  
Please note, this application is very resource heavy. You may need to adjust your [Docker Resource settings](https://docs.docker.com/desktop/mac/) in order to move forward

## Check Kubernetes
Check that your cluster is up and running using the following command
```bash
kubectl get nodes
```

If successful, you should see a node called `minikube` in a table with some other basic information about the cluster.

## Instrument with OpenTelemetry
1. Navigate to [New Relic](https://one.newrelic.com), and sign in with your account.
2. Locate your ingest license key
3. Run the following commands to export env variables and instrument your application with OpenTelemetry. Be sure to update each command to include your New Relic ingest license key. It is also recommended that you keep these commands in a notes file for safe keeping.

```bash
export OTEL_EXPORTER_OTLP_ENDPOINT=https://otlp.nr-data.net:4317
export OTEL_EXPORTER_OTLP_METRICS_ENDPOINT=https://otlp.nr-data.net:4317
export OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=https://otlp.nr-data.net:4317
export OTEL_EXPORTER_OTLP_HEADERS=api-key=<NEWRELIC_INGEST_LICENSE_KEY>
export NEW_RELIC_API_KEY=<NEWRELIC_INGEST_LICENSE_KEY>
export NEW_RELIC_LICENSE_KEY=<NEWRELIC_INGEST_LICENSE_KEY>
export NEW_RELIC_HOST=collector.newrelic.com
```

## Run Skaffold
*Note: this step can take up to 15 minutes the first time you run this command because Docker has to build and push each of the microservices*

```bash
skaffold dev
```
 
This environment will be done building when all 13 deployments are launched. You will see a consistant flow of data being displayed in your terminal window. This is data being generated by the load generator.

You can navigate to [localhost:3000](*) to see a live version of your application **<-- needs updating. this is not true yet**

If any unexpected errors occur during deployment, attempt to run this command one more time before retracing your steps in this lab to see what may have gone wrong.

## View your data in New Relic
1. Navigate to [New Relic](https://one.newrelic.com)
2. Locate `Services - OpenTelemetry` under all entities
3. You should see 9 services related to this applcation running and recieving throughput. You will also see a 10th service `emailservice` if you navigate to APM in New Relic.


## That's it
Well done! You've set up a local version of Hipster Shop instrumented with OpenTelemetry. It's now time to move on to lab 2 of the workshop: [Debugging a slow trace](lab_2-Debugging-a-slow-trace.md)